<!DOCTYPE html>
<html>
	<head>
		<title>UBIQ - Users controller</title>

        <meta charset="UTF-8">
		<link rel="stylesheet" type="text/css" href="main.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<link href="https://fonts.googleapis.com/css?family=Sarabun:100,200,300,400,500,600,700,800" rel="stylesheet">
	</head>
	<body>
		<img src="logo.png">
		
		<form id="form">
			<h1>User controller</h1>
			<input type="text" placeholder="Name" name="name" required id="name"><br><br>
			<input type="text" placeholder="Email" name="email" id="email"><br><br>
			<input type="password" name="password" id="password" placeholder="password"><br><br>
			<button onclick="create()" value="crear usuario">Crear</button>
		</form>

		<button id="logout" onclick="CerrarSesion()">Log out</button>
		<p id="error" class="hidden, error"></p>
		<div id="usersList"></div>
	</body>

	<script type="text/javascript">
		
		$("#form").submit(function(e){
			e.preventDefault();
		});
		if(!localStorage.getItem("token")){
			window.location = "login.html";
		}

		var token = localStorage.getItem("token"); 
		var name = document.getElementById("name").value;
		//comprobar token

		$.ajax({
			url:"http://localhost:8888/ubiq/public/api/user",
			type: "GET",

			headers:
			{				
				'Authorization' : token
			},

			success: function(response){
				var users = response.users;
				var ids = response.ids;
				showUsers(users, ids);
				loadUsersInForm(users, ids);
			},
				
			error: function() {
				console.log("Error :(");
			}
		});

		function create() { 
			var name = $("#name").val();
	        var email = $("#email").val();
	        var password = $("#password").val();
	           $.ajax({
	           type: "POST",
	           url: 'http://localhost:8888/ubiq/public/api/user',
	           
	           data: {
	            'name':name,
	            'password':password,
	            'email':email                
	           },
	           success: function(response){

	             console.log("Usuario creado", response.responseJSON);
	           },

	           error: function(response){
	                console.log(response.responseJSON);           
	                $('#error').text(response.responseJSON);
	                $('#error').removeClass('hidden');
	           }
	       });
		}

		/*function showUsers(users, ids, names){
			for(var user in users){
				console.log(users[user]);
				$('#usersList').append('<div class ="user" id="user' + ids[users]+)
			}
		}*/

		/*function loadUsersInForm(users, IDs) {
        
        	for (var user in users) {            
            
            	$('.selectUsers').append('<option value='+IDs[user]+'>'+users[user]+'</option>');
        	}    
    	}*/

		function showUsers(users, ids){ 
			
			for(var user in users) {
				$('#usersList').append('<div>'+users[user]+'<button id="usersbtn"' + ids[user]+'"onclick="deleteUser('+ids[user]+')>Borrar</button></div><br>');
			}
		}

		function CerrarSesion()
		{
			console.log("CerrarSesion");
			localStorage.clear();
			window.location = "http://localhost:8888/ubiq-client/login.html";  
		}

	</script>
</html>
